clc
clear
syms t p11 p12 p13 p14 p21 p22 p23 p24 p31 p32 p33 p34 p41 p42 p43 p44 s k11 k12 k13 k14 k21 k22 k23 k24
vx=20;
m=1270;
a=1.015;
b=1.895;
iz=1536.7;
cf=55405;
cr=55405;

A=[0    1    0    0;0    -2*(cf+cr)/(m*vx)    2*(cf+cr)/m     -(2*a*cf-2*b*cr)/(m*vx);0     0     0    1;0     -(2*a*cf-2*b*cr)/(iz*vx)    (2*a*cf-2*b*cr)/iz    -(2*a^2*cf+2*b^2*cr)/(iz*vx)];
B=[0 0;2*cf/m -(2*a*cf-2*b*cr)/(m*vx)-vx;0 0;2*a*cf/iz -(2*a^2*cf+2*b^2*cr)/(iz*vx)];
C=[1 0 0 0];
D=0;

sys=ss(A,B,C,D);
eAt=exp(A*t);
eig(A);
jordan(A);
H=tf(sys);
rlocus(H(:,2));
phi_c=[B A*B A^2*B A^3*B];
rank(phi_c);
phi_o=[C; C*A; C*A^2; C*A^3];
rank(phi_o)
% transpose(A)*[p11 p12 p13 p14;p21 p22 p23 p24;p31 p32 p33 p34;p41 p42 p43 p44]+[p11 p12 p13 p14;p21 p22 p23 p24;p31 p32 p33 p34;p41 p42 p43 p44]*A+eye(4)
% S=solve('p11 -(11081*p12)/1270+(22162*p14)/6985=0','(22162*p12)/127-(88648*p14)/1397=0','(8644854522516807*p12)/2251799813685248+p13-(4689851845672989*p14)/281474976710656=0','p14+(8644854522516807*p22)/2251799813685248+p23-(4537568030467737583*p24)/178736610211266560+(22162*p44)/6985=0','p13+(22162*p22)/127-(11081*p23)/1270-(88648*p24)/1397+(22162*p34)/6985=0','p12+p12-(11081*p22)/635+(22162*p24)/6985+(22162*p24)/6985+1=1','(22162*p23)/127+(22162*p23)/127-(88648*p34)/1397-(88648*p34)/1397+1=1','(22162*p24)/127+(8644854522516807*p23)/2251799813685248+p33-(4689851845672989*p34)/281474976710656-(88648*p44)/1397=0','(8644854522516807*p24)/2251799813685248+p34+(8644854522516807*p24)/2251799813685248+p34-(4689851845672989*p44)/140737488355328+1=1')
% S=[S.p11 S.p12 S.p13 S.p14 S.p22 S.p23 S.p24 S.p33 S.p34 S.p44]
[V,D2] = eig(A)
phi_op=[C*B C*A*B C*A^2*B C*A^3*B]
rank(phi_op)
ak=[25.39 196.7 0 0];
alphak=[40 200 10 0];
psi=[1 196.7 0 0;0 1 196.7 0;0 0 1 196.7;0 0 0 1];

% k=(alphak-ak)*inv(psi)*pinv(phi_c);
k=[k11 k12 k13 k14;k21 k22 k23 k24];
k2=[80 6 40 6;5 3 6 1];
A2=A-B*k2;

format short
det(s*eye(4)-A2)
sys2=ss(A2,B,C,D);
G=tf(sys2);
% S = stepinfo(sys2,'RiseTimeLimits',[0.05,0.95])
pole(G(:,1))
pole(G(:,2))